#!/usr/bin/env bash

# Check for entr (required for file watching)
if ! command -v entr &> /dev/null; then
  echo "Error: 'entr' is required for file watching but not installed."
  echo ""
  echo "Install with:"
  echo "  brew install entr    # macOS"
  echo "  apt install entr     # Debian/Ubuntu"
  echo ""
  exit 1
fi

# Generate initial docs
bundle exec yard doc

echo ""
echo "Starting YARD development server..."
echo "Visit http://localhost:8809"
echo ""

# Run web server and file watcher
# Requires: brew install overmind entr (or foreman)
if command -v overmind &> /dev/null; then
  overmind start -f Procfile.yard
elif command -v foreman &> /dev/null; then
  foreman start -f Procfile.yard
else
  echo "Install overmind or foreman to run with auto-rebuild:"
  echo "  brew install overmind entr"
  echo ""
  echo "Falling back to static server (no auto-rebuild)..."
  ruby -run -ehttpd doc -p8809
fi
